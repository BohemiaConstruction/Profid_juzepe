<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_product_template_form_inherited" model="ir.ui.view">
        <field name="name">view.product.template.form.inherited</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='sales']" position="inside">
                <div class="oe_chatter">
                    <canvas id="salesChart" style="max-width: 600px;"></canvas>
                </div>
                <script src="/web/static/lib/Chart.bundle.js"></script>
                <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        var urlParams = new URLSearchParams(window.location.search);
                        var product_id = urlParams.get('id');

                        if (!product_id) {
                            console.error("Product ID not found in URL params");
                            return;
                        }

                        $.getJSON('/product_turnover/data/' + product_id, function(data) {
                            var ctx = document.getElementById('salesChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: data.dates,
                                    datasets: [{
                                        label: 'Sales',
                                        data: data.sales,
                                        borderColor: 'blue',
                                        fill: false
                                    }]
                                }
                            });
                        }).fail(function() {
                            console.error("Failed to load sales data");
                        });
                    });
                </script>
            </xpath>
        </field>
    </record>
</odoo>
